# üêæ Veterinaria Mordisco - Documentaci√≥n del Proyecto

![Banner Veterinaria Mordisco](https://via.placeholder.com/800x200/5cad8a/FFFFFF?text=Veterinaria+Mordisco)

## üìã √çndice
1. [¬øQu√© es Veterinaria Mordisco?](#qu√©-es-veterinaria-mordisco)
2. [Manual R√°pido de Uso](#manual-r√°pido-de-uso)
3. [Arquitectura T√©cnica](#arquitectura-t√©cnica)
4. [Construcci√≥n del Backend](#construcci√≥n-del-backend)
5. [Construcci√≥n del Frontend](#construcci√≥n-del-frontend)
6. [Sistema de Autenticaci√≥n y Roles](#sistema-de-autenticaci√≥n-y-roles)
7. [Sistema de Dise√±o](#sistema-de-dise√±o)
8. [Componentes Reutilizables](#componentes-reutilizables)
9. [API de Integraci√≥n](#api-de-integraci√≥n)
10. [Proceso de Desarrollo](#proceso-de-desarrollo)
11. [Mejoras y Actualizaciones Implementadas](#mejoras-y-actualizaciones-implementadas)
12. [Gu√≠a Completa de M√≥dulos del Sistema](#gu√≠a-completa-de-m√≥dulos-del-sistema)

## ÔøΩ ¬øQu√© es Veterinaria Mordisco?

Veterinaria Mordisco es una **aplicaci√≥n web completa** para la gesti√≥n diaria de cl√≠nicas veterinarias, que permite:

üü¢ **Gestionar clientes** con todos sus datos y contactos  
üü¢ **Administrar pacientes** (mascotas) con historial y caracter√≠sticas  
üü¢ **Agendar citas** con calendario y notificaciones  
üü¢ **Controlar usuarios** del sistema con diferentes roles  

El sistema cuenta con:
- Interfaz moderna e intuitiva
- Modo claro y oscuro adaptable
- Dise√±o responsivo para dispositivos m√≥viles
- Arquitectura escalable y mantenible

## üì± Manual R√°pido de Uso

### Iniciar sesi√≥n y navegaci√≥n

**Paso 1:** Accede con tus credenciales en la pantalla de login  
![Login](https://via.placeholder.com/400x200/5cad8a/FFFFFF?text=Pantalla+Login)

**Paso 2:** Navega por el men√∫ lateral para acceder a las diferentes secciones  
![Dashboard](https://via.placeholder.com/400x200/5cad8a/FFFFFF?text=Dashboard)

### Gesti√≥n de pacientes y clientes

**A√±adir un nuevo paciente:**

```javascript
// Ejemplo simplificado del componente para crear un paciente
function CrearPaciente() {
  // 1. Definimos el estado para guardar los datos
  const [paciente, setPaciente] = useState({
    nombre: '',
    especie: '',
    raza: '',
    edad: '',
    clienteId: ''
  });
  
  // 2. Funci√≥n para enviar datos
  const guardarPaciente = async () => {
    await pacienteService.crear(paciente);
    // Mostrar notificaci√≥n de √©xito
  };
  
  // 3. Formulario con campos necesarios
  return (
    <form onSubmit={guardarPaciente}>
      <input 
        value={paciente.nombre} 
        onChange={(e) => setPaciente({...paciente, nombre: e.target.value})}
      />
      {/* M√°s campos del formulario */}
      <button type="submit">Guardar Paciente</button>
    </form>
  );
}
```

### Flujo de trabajo recomendado:

1. **Registra al cliente** primero con todos sus datos de contacto
2. **A√±ade sus mascotas** (pacientes) vincul√°ndolas al cliente
3. **Agenda citas** seleccionando la mascota y el motivo de la consulta
4. **Consulta el historial** para seguimiento de casos

## üèóÔ∏è Estructura del Proyecto

El proyecto est√° organizado en dos carpetas principales:

### üîπ veterinaria-backend
Contiene toda la l√≥gica del servidor, implementada con Node.js y Express, siguiendo un patr√≥n MVC.

### üîπ veterinaria-frontend
Aplicaci√≥n cliente desarrollada con React, organizada por componentes y siguiendo una arquitectura de servicios para la comunicaci√≥n con el backend.

## ‚öôÔ∏è Backend

### Estructura y m√≥dulos

```
veterinaria-backend/
‚îú‚îÄ‚îÄ app.js                   # Punto de entrada de la aplicaci√≥n
‚îú‚îÄ‚îÄ package.json             # Dependencias del proyecto
‚îú‚îÄ‚îÄ veterinaria.sql          # Script de base de datos
‚îú‚îÄ‚îÄ config/                  # Configuraciones
‚îÇ   ‚îú‚îÄ‚îÄ database.js          # Configuraci√≥n de conexi√≥n a la BD
‚îÇ   ‚îî‚îÄ‚îÄ jwt/                 # Configuraci√≥n de autenticaci√≥n
‚îÇ       ‚îî‚îÄ‚îÄ jwt.config.js
‚îú‚îÄ‚îÄ controllers/             # Controladores
‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.js   # Manejo de autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ cita.controller.js   # Controlador de citas
‚îÇ   ‚îú‚îÄ‚îÄ cliente.controller.js # Controlador de clientes
‚îÇ   ‚îú‚îÄ‚îÄ paciente.controller.js # Controlador de pacientes
‚îÇ   ‚îî‚îÄ‚îÄ usuario.controller.js # Controlador de usuarios
‚îú‚îÄ‚îÄ middleware/              # Middleware personalizado
‚îÇ   ‚îî‚îÄ‚îÄ auth.middleware.js   # Verificaci√≥n de autenticaci√≥n
‚îú‚îÄ‚îÄ models/                  # Modelos de datos
‚îÇ   ‚îú‚îÄ‚îÄ cita.js
‚îÇ   ‚îú‚îÄ‚îÄ cliente.js
‚îÇ   ‚îú‚îÄ‚îÄ index.js             # Exportaci√≥n de modelos
‚îÇ   ‚îú‚îÄ‚îÄ paciente.js
‚îÇ   ‚îî‚îÄ‚îÄ usuario.js
‚îú‚îÄ‚îÄ routes/                  # Definici√≥n de rutas API
‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.js
‚îÇ   ‚îú‚îÄ‚îÄ cita.routes.js
‚îÇ   ‚îú‚îÄ‚îÄ cliente.routes.js
‚îÇ   ‚îú‚îÄ‚îÄ paciente.routes.js
‚îÇ   ‚îî‚îÄ‚îÄ usuario.routes.js
‚îî‚îÄ‚îÄ services/                # Servicios de l√≥gica de negocio
    ‚îú‚îÄ‚îÄ cita.service.js
    ‚îú‚îÄ‚îÄ cliente.service.js
    ‚îú‚îÄ‚îÄ paciente.service.js
    ‚îî‚îÄ‚îÄ usuario.service.js
```

### M√≥dulos y sus responsabilidades

#### üî∏ Models
Definen la estructura de datos y las operaciones de acceso a la base de datos.

- **usuario.js**: Gesti√≥n de usuarios y autenticaci√≥n
- **cliente.js**: Administraci√≥n de clientes
- **paciente.js**: Gesti√≥n de mascotas/pacientes
- **cita.js**: Gesti√≥n de citas y agenda

#### üî∏ Services
Contienen la l√≥gica de negocio, act√∫an como intermediarios entre los controladores y los modelos.

- **usuario.service.js**: Servicios para gesti√≥n de usuarios
- **cliente.service.js**: Servicios para gesti√≥n de clientes
- **paciente.service.js**: Servicios para gesti√≥n de pacientes
- **cita.service.js**: Servicios para gesti√≥n de citas

#### üî∏ Controllers
Manejan las solicitudes HTTP, llaman a los servicios y devuelven las respuestas.

- **auth.controller.js**: Login, registro y gesti√≥n de sesiones
- **usuario.controller.js**: CRUD de usuarios
- **cliente.controller.js**: CRUD de clientes
- **paciente.controller.js**: CRUD de pacientes
- **cita.controller.js**: CRUD de citas

#### üî∏ Routes
Definen los endpoints de la API y conectan con los controladores correspondientes.

- **auth.routes.js**: `/api/auth/login`, `/api/auth/register`, etc.
- **usuario.routes.js**: `/api/usuarios`, `/api/usuarios/:id`, etc.
- **cliente.routes.js**: `/api/clientes`, `/api/clientes/:id`, etc.
- **paciente.routes.js**: `/api/pacientes`, `/api/pacientes/:id`, etc.
- **cita.routes.js**: `/api/citas`, `/api/citas/:id`, etc.

## üõ†Ô∏è Construcci√≥n del Backend

### Estructura en capas

El backend est√° organizado en una **estructura de carpetas intuitiva y modular**:

```
BACKEND
   ‚îÇ
   ‚îú‚îÄ‚îÄ models           # Definici√≥n de datos y acceso a base de datos
   ‚îÇ
   ‚îú‚îÄ‚îÄ services         # L√≥gica de negocio central
   ‚îÇ 
   ‚îú‚îÄ‚îÄ controllers      # Manejo de peticiones HTTP
   ‚îÇ
   ‚îî‚îÄ‚îÄ routes           # Definici√≥n de endpoints de API
```

### ¬øC√≥mo funciona cada solicitud?

Cada petici√≥n sigue un **flujo claro y ordenado**:

```
Cliente ‚Üí Ruta ‚Üí Controlador ‚Üí Servicio ‚Üí Modelo ‚Üí Base de Datos
```

**Ejemplo pr√°ctico:** Obtener todos los pacientes

1. **Ruta definida** en `paciente.routes.js`:
   ```javascript
   // Define URL y m√©todo HTTP
   router.get('/pacientes', pacienteController.listar);
   ```

2. **Controlador** en `paciente.controller.js`:
   ```javascript
   // Recibe la petici√≥n HTTP y llama al servicio
   exports.listar = async (req, res) => {
     try {
       // Obtiene par√°metros de consulta (filtros, paginaci√≥n)
       const { especie, estado } = req.query;
       
       // Llama al servicio correspondiente
       const pacientes = await pacienteService.listarPacientes(especie, estado);
       
       // Devuelve respuesta formateada
       return res.status(200).json({ 
         exito: true, 
         datos: pacientes 
       });
     } catch (error) {
       return res.status(500).json({ 
         exito: false, 
         mensaje: error.message 
       });
     }
   };
   ```

3. **Servicio** en `paciente.service.js`:
   ```javascript
   // Contiene la l√≥gica de negocio
   exports.listarPacientes = async (especie, estado) => {
     // Prepara criterios de b√∫squeda
     const criterios = {};
     if (especie) criterios.especie = especie;
     if (estado) criterios.estadoSalud = estado;
     
     // Llama al modelo para acceder a datos
     return await Paciente.buscarPorCriterios(criterios);
   };
   ```

4. **Modelo** en `paciente.js`:
   ```javascript
   // Interact√∫a con la base de datos
   exports.buscarPorCriterios = async (criterios) => {
     // Construye y ejecuta consulta SQL
     const sql = 'SELECT * FROM pacientes WHERE ?';
     return await db.query(sql, criterios);
   };
   ```

### Base de datos

La estructura de datos est√° optimizada para almacenar toda la informaci√≥n necesaria:

```sql
-- Ejemplo simplificado del esquema
CREATE TABLE clientes (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  email VARCHAR(100) UNIQUE,
  telefono VARCHAR(20),
  direccion TEXT,
  fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE pacientes (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  especie VARCHAR(50),
  raza VARCHAR(100),
  fecha_nacimiento DATE,
  cliente_id INT,
  FOREIGN KEY (cliente_id) REFERENCES clientes(id)
);
```

## üñ•Ô∏è Frontend

### Estructura y m√≥dulos

```
veterinaria-frontend/
‚îú‚îÄ‚îÄ public/                  # Archivos est√°ticos
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ App.js               # Componente principal
‚îÇ   ‚îú‚îÄ‚îÄ index.js             # Punto de entrada
‚îÇ   ‚îú‚îÄ‚îÄ assets/              # Recursos est√°ticos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ components/          # Componentes React
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProtectedRoute.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ThemeSwitcher.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminPanel/      # Componentes de administraci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard/       # Componentes del panel principal
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Sidebar/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NotFound/
‚îÇ   ‚îú‚îÄ‚îÄ consumo-api/         # Configuraci√≥n de llamadas API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.config.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.api.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cita.api.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cliente.api.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ paciente.api.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usuario.api.js
‚îÇ   ‚îú‚îÄ‚îÄ estilo/              # Hojas de estilo CSS
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardLayout.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Pacientes.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ThemeSwitcher.css
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Usuarios.css
‚îÇ   ‚îú‚îÄ‚îÄ services/            # Servicios del frontend
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cita.service.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cliente.service.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ http.service.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ paciente.service.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usuario.service.js
‚îÇ   ‚îî‚îÄ‚îÄ styles/              # Estilos adicionales
```

### M√≥dulos y componentes principales

#### üî∏ Componentes

**Autenticaci√≥n y Seguridad**
- **Login.js**: Formulario de inicio de sesi√≥n
- **ProtectedRoute.js**: Componente HOC para proteger rutas privadas

**Panel de Administraci√≥n**
- **AdminPanel.js**: Panel principal de administraci√≥n
- **GestionClientes.js**: CRUD de clientes
- **GestionPacientes.js**: CRUD de pacientes
- **GestionUsuarios.js**: CRUD de usuarios

**Dashboard**
- **Dashboard.js**: Panel principal de inicio
- **DashboardLayout.js**: Layout com√∫n para todas las vistas internas
- **Sidebar.js**: Barra lateral de navegaci√≥n

**Otros**
- **ThemeSwitcher.js**: Alternador de tema claro/oscuro
- **NotFound.js**: P√°gina 404

#### üî∏ API y Servicios

**Configuraci√≥n API**
- **api.config.js**: Configuraci√≥n base para Axios
- **auth.api.js**: Endpoints de autenticaci√≥n
- **cliente.api.js**: Endpoints de clientes
- **paciente.api.js**: Endpoints de pacientes
- **cita.api.js**: Endpoints de citas
- **usuario.api.js**: Endpoints de usuarios

**Servicios**
- **http.service.js**: Servicio base para solicitudes HTTP
- **auth.service.js**: Gesti√≥n de autenticaci√≥n (login/logout)
- **cliente.service.js**: Funcionalidad de clientes
- **paciente.service.js**: Funcionalidad de pacientes
- **cita.service.js**: Funcionalidad de citas
- **usuario.service.js**: Funcionalidad de usuarios

## üé® Sistema de Dise√±o

### Temas claro y oscuro

La aplicaci√≥n implementa un **sistema de temas completo** utilizando variables CSS:

![Temas](https://via.placeholder.com/600x300/5cad8a/FFFFFF?text=Modo+Claro+y+Oscuro)

```css
/* Variables CSS que permiten alternar temas */
:root {
  /* Tema claro (predeterminado) */
  --primary-color: #5cad8a;     /* Verde principal */
  --card-bg: #ffffff;           /* Fondo de tarjetas */
  --text-primary: #333333;      /* Texto principal */
  --text-secondary: #6c757d;    /* Texto secundario */
  --input-bg: #f8f9fa;          /* Fondo de inputs */
  --border-color: #dee2e6;      /* Color de bordes */
}

/* Tema oscuro activado con atributo data-theme */
[data-theme='dark'] {
  --card-bg: #212529;           /* Fondo oscuro */
  --text-primary: #e9ecef;      /* Texto claro */
  --text-secondary: #adb5bd;    /* Texto secundario */
  --input-bg: #2b3035;          /* Inputs oscuros */
  --border-color: #495057;      /* Bordes m√°s visibles */
}
```

### Componentes visuales principales

Cada elemento visual est√° cuidadosamente dise√±ado para mantener **consistencia y usabilidad**:

#### 1. Fichas de informaci√≥n

Las fichas de pacientes muestran informaci√≥n clara y estructurada:

```css
/* Estilos de la ficha de paciente */
.ficha-paciente {
  /* Aspecto visual */
  background-color: rgba(0, 0, 0, 0.2);
  border-radius: 16px;
  padding: 22px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  
  /* Estructura y layout */
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 18px;
  
  /* Efectos visuales */
  box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.15);
  position: relative;
  overflow: hidden;
}

.ficha-item {
  /* Tarjeta individual de informaci√≥n */
  background-color: rgba(255, 255, 255, 0.03);
  padding: 12px 15px;
  border-radius: 12px;
  transition: all 0.2s ease;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

/* Efectos interactivos */
.ficha-item:hover {
  transform: translateY(-2px);
  background-color: rgba(255, 255, 255, 0.05);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
```

![Ficha de Paciente](https://via.placeholder.com/400x200/5cad8a/FFFFFF?text=Ficha+de+Paciente)

#### 2. Modales interactivos

Ventanas de di√°logo para operaciones CRUD con estilo consistente:

```css
/* Sistema de modales */
.modal-backdrop {
  /* Fondo semi-transparente */
  position: fixed !important;
  background-color: rgba(0, 0, 0, 0.7) !important;
  
  /* Centrado perfecto */
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  
  /* Cobertura total */
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  z-index: 9999 !important;
}

.modal-content {
  /* Aspecto visual adaptable al tema */
  background-color: var(--card-bg) !important;
  color: var(--text-primary);
  
  /* Dimensiones y l√≠mites */
  max-width: 650px !important;
  width: 100% !important;
  max-height: 90vh !important;
  
  /* Estilo y efectos */
  border-radius: 12px !important;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5) !important;
  padding: 25px !important;
  overflow-y: auto;
}
```

![Modal de Edici√≥n](https://via.placeholder.com/400x200/5cad8a/FFFFFF?text=Modal+de+Edici√≥n)

#### 3. Tablas de datos

Sistema de visualizaci√≥n de datos con ordenamiento y paginaci√≥n:

```css
/* Contenedor de tabla con scroll horizontal */
.datatable-container {
  width: 100%;
  overflow-x: auto;
  border-radius: 14px;
  
  /* Efectos visuales */
  border: 1px solid rgba(255, 255, 255, 0.12);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15), 
              inset 0 0 15px rgba(0, 0, 0, 0.1);
  
  /* Estilizado del scroll */
  scrollbar-width: thin;
  scrollbar-color: rgba(92, 173, 138, 0.5) rgba(0, 0, 0, 0.2);
}

/* Tabla responsiva */
.datatable {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  color: var(--text-primary);
  font-size: 0.9rem;
}

/* Encabezados interactivos */
.datatable th.sortable:hover {
  background-color: rgba(92, 173, 138, 0.25);
  color: var(--primary-color);
}
```

### Responsividad adaptable

El dise√±o se **adapta autom√°ticamente** a diferentes tama√±os de pantalla:

```css
/* Tablets */
@media (max-width: 992px) {
  .datatable-container {
    padding: 0;
  }
  
  .pacientes-header {
    flex-direction: column;
    align-items: flex-start;
  }
}

/* M√≥viles */
@media (max-width: 768px) {
  .modal-content {
    padding: 15px !important;
  }
  
  .ficha-paciente {
    grid-template-columns: 1fr; /* Una sola columna */
  }
  
  .datatable th,
  .datatable td {
    padding: 8px 10px; /* Celdas m√°s compactas */
  }
}
```

### Configuraci√≥n de ThemeSwitcher

El cambiador de temas funciona modificando un atributo de datos en el HTML:

```javascript
// Componente ThemeSwitcher simplificado
function ThemeSwitcher() {
  const [theme, setTheme] = useState('dark');
  
  const toggleTheme = () => {
    const newTheme = theme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
  };
  
  return (
    <button onClick={toggleTheme} className="theme-switcher">
      {theme === 'light' ? 'üåô' : '‚òÄÔ∏è'}
    </button>
  );
}
```

## üîê Sistema de Autenticaci√≥n y Roles

El sistema implementa un **robusto sistema de autenticaci√≥n basado en JWT** con control de roles granular que garantiza la seguridad y el acceso controlado a las diferentes funcionalidades.

### Arquitectura del Sistema de Autenticaci√≥n

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend   ‚îÇ‚îÄ‚îÄ‚ñ∫‚îÇ  JWT Token   ‚îÇ‚îÄ‚îÄ‚ñ∫‚îÇ  Middleware  ‚îÇ‚îÄ‚îÄ‚ñ∫‚îÇ   Backend    ‚îÇ
‚îÇ              ‚îÇ   ‚îÇ Verificaci√≥n ‚îÇ   ‚îÇ Autorizaci√≥n ‚îÇ   ‚îÇ   Seguro     ‚îÇ
‚îÇ              ‚îÇ   ‚îÇ              ‚îÇ   ‚îÇ              ‚îÇ   ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Roles del Sistema

El sistema maneja **dos tipos de usuarios principales**:

- **üî∏ Administrador** (`admin`) - Acceso completo al sistema
- **üî∏ Usuario/Veterinario** (`usuario`) - Acceso limitado a funciones operativas

### Implementaci√≥n del Sistema de Roles

#### 1. Middleware de Autenticaci√≥n (Backend)

```javascript
// auth.middleware.js - Verificaci√≥n de tokens JWT
const verifyToken = (req, res, next) => {
  // Obtener el token del encabezado
  const token = req.headers['x-access-token'] || req.headers['authorization'];
  
  if (!token) {
    return res.status(403).json({ 
      success: false, 
      message: "Se requiere un token para la autenticaci√≥n" 
    });
  }

  try {
    // Eliminar el prefijo "Bearer " si existe
    const tokenValue = token.startsWith('Bearer ') ? token.slice(7, token.length) : token;
    
    // Verificar el token
    const decoded = jwt.verify(tokenValue, jwtConfig.jwtSecret);
    
    // Agregar el usuario decodificado al request
    req.usuario = decoded.usuario;
    next();
  } catch (error) {
    return res.status(401).json({
      success: false,
      message: "Token no v√°lido o expirado"
    });
  }
};

// Middleware para verificar roles espec√≠ficos
const verifyRole = (roles) => {
  return (req, res, next) => {
    if (!req.usuario) {
      return res.status(403).json({
        success: false,
        message: "Se requiere autenticaci√≥n"
      });
    }

    // Verificar si el usuario tiene uno de los roles permitidos
    if (roles.includes(req.usuario.rol)) {
      next();
    } else {
      res.status(403).json({
        success: false,
        message: "No tiene permisos para realizar esta acci√≥n"
      });
    }
  };
};
```

#### 2. Autenticaci√≥n en el Controlador (Backend)

```javascript
// auth.controller.js - Manejo de login y generaci√≥n de tokens
const login = async (req, res) => {
  try {
    const { correo, contrasenia } = req.body;

    // Buscar usuario por correo y verificar que est√© activo
    const usuario = await Usuario.findOne({ 
      where: { 
        correo,
        estado: 'A' 
      } 
    });

    if (!usuario) {
      return res.status(401).json({
        success: false,
        message: 'Credenciales inv√°lidas'
      });
    }

    // Verificar la contrase√±a hasheada
    const passwordValido = await bcrypt.compare(contrasenia, usuario.contrasenia);

    if (!passwordValido) {
      return res.status(401).json({
        success: false,
        message: 'Credenciales inv√°lidas'
      });
    }

    // Crear el payload del token con informaci√≥n del usuario y rol
    const payload = {
      usuario: {
        id: usuario.id_usuario,
        nombre: usuario.nombre,
        correo: usuario.correo,
        rol: usuario.rol  // ‚≠ê Rol incluido en el token
      }
    };

    // Generar el token JWT
    jwt.sign(
      payload,
      jwtConfig.jwtSecret,
      { expiresIn: jwtConfig.jwtExpiration },
      (err, token) => {
        if (err) throw err;
        
        // Responder con el token y la informaci√≥n del usuario
        res.json({
          success: true,
          message: 'Login exitoso',
          token,
          usuario: {
            id: usuario.id_usuario,
            nombre: usuario.nombre,
            correo: usuario.correo,
            rol: usuario.rol  // ‚≠ê Rol disponible para el frontend
          }
        });
      }
    );
  } catch (error) {
    console.error('Error en login:', error);
    res.status(500).json({
      success: false,
      message: 'Error en el servidor'
    });
  }
};
```

#### 3. Servicios de Autenticaci√≥n (Frontend)

```javascript
// auth.service.js - Gesti√≥n de autenticaci√≥n en el frontend
class AuthService {
  /**
   * Verifica si hay un usuario autenticado
   * @returns {boolean} - True si hay un usuario autenticado
   */
  isAuthenticated() {
    return this.getToken() !== null;
  }

  /**
   * Verifica si el usuario tiene un rol espec√≠fico
   * @param {string} requiredRole - Rol requerido para acceder
   * @returns {boolean} - True si el usuario tiene el rol requerido
   */
  hasRole(requiredRole) {
    const user = this.getCurrentUser();
    return user?.usuario?.rol === requiredRole;
  }

  /**
   * Obtiene el usuario actual desde el localStorage
   * @returns {Object|null} - Datos del usuario o null si no hay sesi√≥n
   */
  getCurrentUser() {
    const userStr = localStorage.getItem('user');
    if (!userStr) return null;
    
    try {
      return JSON.parse(userStr);
    } catch (e) {
      this.logout(); // Si hay un error en el parsing, limpiar datos
      return null;
    }
  }

  /**
   * Obtiene el token JWT almacenado
   * @returns {string|null} - Token JWT o null si no hay sesi√≥n
   */
  getToken() {
    const user = this.getCurrentUser();
    return user?.token || null;
  }
}
```

#### 4. Componente ProtectedRoute (Frontend)

```javascript
// ProtectedRoute.js - Componente de protecci√≥n de rutas
const ProtectedRoute = ({ children, requiredRole }) => {
  // Verificar si el usuario est√° autenticado
  const isAuthenticated = authService.isAuthenticated();
  
  // Si se especific√≥ un rol requerido, verificar si el usuario tiene ese rol
  const hasRequiredRole = requiredRole 
    ? authService.hasRole(requiredRole)
    : true;

  console.log('¬øEst√° autenticado?', isAuthenticated);
  console.log('¬øTiene rol requerido?', hasRequiredRole, 'Rol requerido:', requiredRole);

  // Si el usuario no est√° autenticado o no tiene el rol requerido, redirigir al login
  if (!isAuthenticated || !hasRequiredRole) {
    console.log('Redirigiendo al login');
    return <Navigate to="/login" replace />;
  }

  // Si el usuario est√° autenticado y tiene el rol requerido, mostrar el contenido
  console.log('Renderizando ruta protegida');
  return children;
};
```

#### 5. Configuraci√≥n de Rutas con Roles

```javascript
// App.js - Configuraci√≥n de rutas protegidas por rol
function App() {
  return (
    <Router>
      <div className="App">
        <Routes>
          {/* Ruta p√∫blica */}
          <Route path="/login" element={<Login />} />
          
          {/* Rutas protegidas b√°sicas - Solo requieren autenticaci√≥n */}
          <Route 
            path="/dashboard" 
            element={
              <ProtectedRoute>
                <DashboardLayout>
                  <Dashboard />
                </DashboardLayout>
              </ProtectedRoute>
            }
          />
          
          {/* Rutas protegidas con rol espec√≠fico - Solo administradores */}
          <Route 
            path="/admin" 
            element={
              <ProtectedRoute requiredRole="admin">
                <DashboardLayout />
              </ProtectedRoute>
            }
          >
            <Route index element={<AdminPanel />} />
          </Route>
          
          <Route path="*" element={<NotFound />} />
        </Routes>
      </div>
    </Router>
  );
}
```

#### 6. Control de Acceso en Componentes

```javascript
// GestionUsuarios.js - Control granular de acceso
function GestionUsuarios() {
  // Verificar si el usuario es administrador
  const isAdmin = authService.hasRole('administrador');

  return (
    <div className="page-content">
      {/* Verificar si el usuario tiene permisos */}
      {!isAdmin ? (
        <div className="usuarios-container fade-in">
          <div className="alert alert-danger">
            <div className="alert-icon">üö´</div>
            <div className="alert-content">
              <p className="alert-message">
                <strong>Acceso Denegado:</strong> No tiene permisos para acceder a la gesti√≥n de usuarios. 
                Esta funci√≥n est√° disponible √∫nicamente para administradores.
              </p>
            </div>
          </div>
        </div>
      ) : (
        // Contenido para administradores
        <div className="usuarios-container fade-in">
          <div className="usuarios-header">
            <h2>üë• Gesti√≥n de Usuarios</h2>
            <button 
              className="btn btn-primary"
              onClick={() => handleShowModal('create')}
            >
              ‚ûï Nuevo Usuario
            </button>
          </div>
          
          {/* Tabla completa de usuarios con funciones CRUD */}
          <DataTable 
            datos={usuarios}
            columnas={columnasUsuarios}
            acciones={accionesUsuarios}
          />
        </div>
      )}
    </div>
  );
}
```

#### 7. Interceptores HTTP con Autenticaci√≥n

```javascript
// api.config.js - Configuraci√≥n de Axios con interceptores
const apiClient = axios.create({
  baseURL: API_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Interceptor para a√±adir el token de autenticaci√≥n autom√°ticamente
apiClient.interceptors.request.use(
  (config) => {
    const userStr = localStorage.getItem('user');
    if (userStr) {
      try {
        const user = JSON.parse(userStr);
        if (user.token) {
          config.headers.Authorization = `Bearer ${user.token}`;
        }
      } catch (e) {
        console.error('Error al parsear datos de usuario:', e);
      }
    }
    return config;
  }
);

// Interceptor para manejar errores de autenticaci√≥n
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    // Si el token expir√≥ o es inv√°lido, redirigir al login
    if (error.response && error.response.status === 401) {
      localStorage.removeItem('user');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);
```

### Flujo de Autenticaci√≥n Completo

```
1. Usuario ingresa credenciales
2. Backend verifica credenciales y genera JWT
3. JWT contiene informaci√≥n del usuario + rol
4. Frontend almacena JWT en localStorage
5. Cada petici√≥n incluye JWT en headers
6. Backend verifica JWT en cada petici√≥n
7. Middleware de roles controla acceso a recursos
8. Frontend verifica roles para mostrar/ocultar componentes
```

### Ventajas del Sistema Implementado

‚úÖ **Seguridad robusta** con tokens JWT firmados  
‚úÖ **Control granular** de acceso por roles  
‚úÖ **Verificaci√≥n tanto en frontend como backend**  
‚úÖ **Interceptores autom√°ticos** para todas las peticiones  
‚úÖ **Manejo centralizado** de expiraci√≥n de tokens  
‚úÖ **Componentes reutilizables** para protecci√≥n de rutas  

## üß© Componentes Reutilizables

La aplicaci√≥n est√° construida usando un enfoque **Component-First** que maximiza la reusabilidad:

### Componentes React compartidos

![Componentes Reutilizables](https://via.placeholder.com/600x300/5cad8a/FFFFFF?text=Componentes+Reutilizables)

#### 2. DashboardLayout

Proporciona una **estructura com√∫n** para todas las pantallas internas:

```javascript
// DashboardLayout.js - Layout principal
function DashboardLayout({ children }) {
  return (
    <div className="dashboard-container">
      <Sidebar />
      
      <div className="content-area">
        <header className="top-header">
          <h1>Veterinaria Mordisco</h1>
          <ThemeSwitcher />
          <UserMenu />
        </header>
        
        <main className="main-content">
          {children}
        </main>
        
        <footer className="app-footer">
          ¬© 2025 Veterinaria Mordisco
        </footer>
      </div>
    </div>
  );
}
```

#### 3. DataTable

Componente **reutilizable para datos tabulares** con ordenamiento y paginaci√≥n:

```javascript
// DataTable.js - Tabla de datos reutilizable
function DataTable({ datos, columnas, acciones, paginacion = true }) {
  const [sortBy, setSortBy] = useState(null);
  const [sortDir, setSortDir] = useState('asc');
  const [pagina, setPagina] = useState(1);
  const itemsPorPagina = 10;
  
  // Ordena los datos seg√∫n la columna seleccionada
  const ordenarDatos = () => {
    if (!sortBy) return datos;
    
    return [...datos].sort((a, b) => {
      if (a[sortBy] < b[sortBy]) return sortDir === 'asc' ? -1 : 1;
      if (a[sortBy] > b[sortBy]) return sortDir === 'asc' ? 1 : -1;
      return 0;
    });
  };
  
  // Calcula los datos para la p√°gina actual
  const datosPaginados = paginacion
    ? ordenarDatos().slice(
        (pagina - 1) * itemsPorPagina,
        pagina * itemsPorPagina
      )
    : ordenarDatos();
  
  // Renderiza la tabla con los datos
  return (
    <div className="datatable-container">
      <table className="datatable">
        {/* Cabecera con columnas ordenables */}
        <thead>
          <tr>
            {columnas.map(col => (
              <th 
                key={col.campo} 
                className={sortBy === col.campo ? `sorted-${sortDir}` : ''}
                onClick={() => /* l√≥gica de ordenamiento */}
              >
                {col.titulo}
              </th>
            ))}
          </tr>
        </thead>
        
        {/* Cuerpo de la tabla */}
        <tbody>
          {datosPaginados.map(fila => (
            <tr key={fila.id}>
              {columnas.map(col => (
                <td key={`${fila.id}-${col.campo}`}>
                  {col.render ? col.render(fila) : fila[col.campo]}
                </td>
              ))}
              {/* Columna de acciones */}
              <td className="datatable-actions">
                {acciones && acciones(fila)}
              </td>
            </tr>
          ))}
        </tbody>
      </table>
      
      {/* Paginaci√≥n */}
      {paginacion && (
        <div className="datatable-pagination">
          {/* Controles de paginaci√≥n */}
        </div>
      )}
    </div>
  );
}
```

### Servicios compartidos entre m√≥dulos

#### 1. http.service.js

Servicio base para **comunicaci√≥n con el backend**:

```javascript
// http.service.js - Servicio base para peticiones HTTP
import axios from 'axios';

const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';

// Instancia de Axios con configuraci√≥n base
const httpClient = axios.create({
  baseURL: API_URL,
  headers: {
    'Content-Type': 'application/json'
  }
});

// Interceptor para incluir el token JWT en peticiones
httpClient.interceptors.request.use(config => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Interceptor para manejar respuestas y errores
httpClient.interceptors.response.use(
  response => response.data,
  error => {
    // Manejo centralizado de errores
    if (error.response && error.response.status === 401) {
      // Token expirado - redirigir a login
      localStorage.removeItem('token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

// M√©todos simplificados para operaciones CRUD
export default {
  get: (url, params) => httpClient.get(url, { params }),
  post: (url, data) => httpClient.post(url, data),
  put: (url, data) => httpClient.put(url, data),
  delete: (url) => httpClient.delete(url)
};
```

## üîå API de Integraci√≥n

La comunicaci√≥n entre frontend y backend se realiza a trav√©s de una **API REST** bien definida:

### Formato de respuestas

Todas las respuestas siguen una **estructura consistente**:

```json
{
  "exito": true,                // Estado de la operaci√≥n (true/false)
  "datos": [...],               // Datos solicitados (si aplica)
  "mensaje": "Texto descriptivo" // Mensaje informativo (si aplica)
}
```

### Endpoints principales con ejemplos

#### Autenticaci√≥n

**Login** - `POST /api/auth/login`

Petici√≥n:
```json
{
  "email": "usuario@ejemplo.com",
  "password": "contrase√±a123"
}
```

Respuesta:
```json
{
  "exito": true,
  "datos": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "usuario": {
      "id": 1,
      "nombre": "Juan P√©rez",
      "email": "usuario@ejemplo.com",
      "rol": "admin"
    }
  },
  "mensaje": "Inicio de sesi√≥n exitoso"
}
```

#### Gesti√≥n de pacientes

**Listar pacientes** - `GET /api/pacientes`

Par√°metros de consulta opcionales:
- `?especie=Perro` - Filtrar por especie
- `?clienteId=5` - Filtrar por cliente
- `?page=1&limit=10` - Paginaci√≥n

Respuesta:
```json
{
  "exito": true,
  "datos": [
    {
      "id": 1,
      "nombre": "Leopoldo",
      "especie": "Perro",
      "raza": "french",
      "edad": "6 a√±os",
      "sexo": "Macho",
      "clienteId": 5,
      "cliente": {
        "nombre": "Ana G√≥mez",
        "telefono": "555-1234"
      }
    },
    // M√°s pacientes...
  ],
  "paginacion": {
    "total": 45,
    "pagina": 1,
    "limite": 10,
    "paginas": 5
  }
}
```

### C√≥digos de respuesta HTTP

La API utiliza **c√≥digos de estado HTTP est√°ndar**:

- **200 OK** - Petici√≥n exitosa
- **201 Created** - Recurso creado exitosamente
- **400 Bad Request** - Error en los par√°metros de la petici√≥n
- **401 Unauthorized** - Autenticaci√≥n requerida o token inv√°lido
- **404 Not Found** - Recurso no encontrado
- **500 Internal Server Error** - Error del servidor

## üîÑ Proceso de Desarrollo

El desarrollo de Veterinaria Mordisco sigui√≥ una **metodolog√≠a √°gil** con iteraciones incrementales:

### Fases del proyecto

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              ‚îÇ   ‚îÇ              ‚îÇ   ‚îÇ              ‚îÇ   ‚îÇ              ‚îÇ   ‚îÇ              ‚îÇ
‚îÇ PLANIFICACI√ìN‚îÇ‚îÄ‚îÄ‚ñ∫‚îÇ  DESARROLLO  ‚îÇ‚îÄ‚îÄ‚ñ∫‚îÇ  DESARROLLO  ‚îÇ‚îÄ‚îÄ‚ñ∫‚îÇ INTEGRACI√ìN  ‚îÇ‚îÄ‚îÄ‚ñ∫‚îÇ  DESPLIEGUE  ‚îÇ
‚îÇ              ‚îÇ   ‚îÇ   BACKEND    ‚îÇ   ‚îÇ   FRONTEND   ‚îÇ   ‚îÇ  Y PRUEBAS   ‚îÇ   ‚îÇ              ‚îÇ
‚îÇ              ‚îÇ   ‚îÇ              ‚îÇ   ‚îÇ              ‚îÇ   ‚îÇ              ‚îÇ   ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 1. Fase de Planificaci√≥n

Se definieron los **requisitos funcionales** del sistema:

‚úÖ Gesti√≥n completa de clientes  
‚úÖ Gesti√≥n de pacientes (mascotas)  
‚úÖ Sistema de citas y calendario  
‚úÖ Panel de administraci√≥n  
‚úÖ Reportes b√°sicos  

Tambi√©n se crearon:
- Diagramas de base de datos
- Wireframes de interfaz
- Historias de usuario prioritizadas

### 2. Desarrollo Backend

Se implement√≥ primero la **API REST completa**:

1. Configuraci√≥n del entorno Node.js y Express
2. Conexi√≥n a base de datos MySQL
3. Implementaci√≥n de modelos de datos
4. Desarrollo de servicios con l√≥gica de negocio
5. Creaci√≥n de controladores REST
6. Implementaci√≥n de autenticaci√≥n JWT
7. Documentaci√≥n de la API

### 3. Desarrollo Frontend

Se construy√≥ la **interfaz de usuario React**:

1. Configuraci√≥n del proyecto con Create React App
2. Dise√±o de la estructura de componentes
3. Implementaci√≥n del sistema de rutas
4. Desarrollo del sistema de autenticaci√≥n
5. Creaci√≥n de los m√≥dulos principales:
   - Login y registro
   - Dashboard principal
   - CRUD de clientes
   - CRUD de pacientes
   - CRUD de citas
   - CRUD de usuarios
6. Implementaci√≥n del sistema de temas claro/oscuro

### 4. Integraci√≥n y Pruebas

Se realiz√≥ la **integraci√≥n completa** y pruebas:

1. Pruebas de integraci√≥n entre frontend y backend
2. Pruebas de usabilidad
3. Optimizaci√≥n de rendimiento
4. Correcci√≥n de errores
5. Ajustes de dise√±o responsivo

### 5. Despliegue

Preparaci√≥n para **entorno de producci√≥n**:

1. Configuraci√≥n de variables de entorno
2. Optimizaci√≥n de assets
3. Configuraci√≥n de servidor
4. Implementaci√≥n de monitoreo b√°sico
5. Documentaci√≥n final

## ÔøΩ Mejoras y Actualizaciones Implementadas

### Sistema de Roles y Permisos Avanzado

El sistema ha sido **significativamente mejorado** con la implementaci√≥n de un robusto sistema de autenticaci√≥n y autorizaci√≥n:

#### ‚≠ê Nuevas Caracter√≠sticas Implementadas

**üî∏ Autenticaci√≥n JWT Completa**
- Tokens firmados con expiraci√≥n autom√°tica
- Verificaci√≥n en cada petici√≥n del backend
- Manejo autom√°tico de tokens expirados

**üî∏ Control de Roles Granular**
- Roles diferenciados: `admin` y `usuario`
- Verificaci√≥n tanto en frontend como backend
- Protecci√≥n de rutas por nivel de acceso

**üî∏ Componentes de Seguridad**
- `ProtectedRoute` mejorado con soporte para roles espec√≠ficos
- Verificaci√≥n autom√°tica de permisos en componentes
- Manejo centralizado de acceso denegado

#### üìã Ejemplo de Implementaci√≥n de Roles

```javascript
// Ejemplo real del componente GestionUsuarios
function GestionUsuarios() {
  // ‚≠ê Verificaci√≥n autom√°tica de permisos de administrador
  const isAdmin = authService.hasRole('administrador');

  return (
    <div className="page-content">
      {!isAdmin ? (
        // üö´ Mensaje de acceso denegado para usuarios sin permisos
        <div className="alert alert-danger">
          <div className="alert-icon">üö´</div>
          <div className="alert-content">
            <p className="alert-message">
              <strong>Acceso Denegado:</strong> No tiene permisos para acceder a la gesti√≥n de usuarios. 
              Esta funci√≥n est√° disponible √∫nicamente para administradores.
            </p>
          </div>
        </div>
      ) : (
        // ‚úÖ Contenido completo para administradores
        <div className="usuarios-container fade-in">
          <div className="usuarios-header">
            <h2>üë• Gesti√≥n de Usuarios</h2>
            <button 
              className="btn btn-primary"
              onClick={() => handleShowModal('create')}
            >
              ‚ûï Nuevo Usuario
            </button>
          </div>
          
          {/* Tabla completa de usuarios con funciones CRUD */}
          <DataTable 
            datos={usuarios}
            columnas={columnasUsuarios}
            acciones={accionesUsuarios}
          />
        </div>
      )}
    </div>
  );
}
```

#### üõ°Ô∏è Seguridad Multicapa

```javascript
// 1. Protecci√≥n en rutas (App.js)
<Route path="/admin" element={
  <ProtectedRoute requiredRole="admin">
    <DashboardLayout />
  </ProtectedRoute>
}>

// 2. Verificaci√≥n en componentes
const isAdmin = authService.hasRole('administrador');

// 3. Middleware en backend
router.post('/usuarios', verifyToken, verifyRole(['admin']), controller.create);

// 4. Interceptores autom√°ticos
apiClient.interceptors.request.use((config) => {
  const token = authService.getToken();
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});
```

#### üìä Flujo de Verificaci√≥n de Permisos

```
Usuario intenta acceder ‚Üí ProtectedRoute verifica ‚Üí authService.hasRole() 
    ‚Üì                           ‚Üì                       ‚Üì
Token v√°lido?              Rol requerido?           Comparar roles
    ‚Üì                           ‚Üì                       ‚Üì
Backend valida JWT    ‚Üí    Middleware verifica   ‚Üí   Acceso permitido/denegado
```

#### üéØ Beneficios de las Mejoras

‚úÖ **Seguridad robusta** - Verificaci√≥n en m√∫ltiples capas  
‚úÖ **Experiencia de usuario mejorada** - Mensajes claros de acceso denegado  
‚úÖ **C√≥digo mantenible** - L√≥gica centralizada de autenticaci√≥n  
‚úÖ **Escalabilidad** - F√°cil agregar nuevos roles y permisos  
‚úÖ **Depuraci√≥n simplificada** - Logs detallados de autenticaci√≥n  

### Arquitectura de Seguridad

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Frontend     ‚îÇ   ‚îÇ    Middleware   ‚îÇ   ‚îÇ    Backend      ‚îÇ
‚îÇ                 ‚îÇ   ‚îÇ                 ‚îÇ   ‚îÇ                 ‚îÇ
‚îÇ ProtectedRoute  ‚îÇ‚îÄ‚îÄ‚ñ∫‚îÇ   verifyToken   ‚îÇ‚îÄ‚îÄ‚ñ∫‚îÇ  Controllers    ‚îÇ
‚îÇ authService     ‚îÇ   ‚îÇ   verifyRole    ‚îÇ   ‚îÇ  Secure Routes  ‚îÇ
‚îÇ hasRole()       ‚îÇ   ‚îÇ                 ‚îÇ   ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## ÔøΩüìù Conclusi√≥n

Veterinaria Mordisco es un sistema **moderno, escalable y f√°cil de mantener** que proporciona todas las herramientas necesarias para la gesti√≥n eficiente de una cl√≠nica veterinaria.

### Principales ventajas

‚úÖ **Arquitectura modular** que facilita el mantenimiento  
‚úÖ **Dise√±o responsivo** adaptado a cualquier dispositivo  
‚úÖ **Sistema de temas** para mayor comodidad visual  
‚úÖ **Componentes reutilizables** para desarrollo √°gil  
‚úÖ **API REST** bien documentada para posibles integraciones  
‚úÖ **Experiencia de usuario** intuitiva y agradable  
‚úÖ **Sistema de roles robusto** con autenticaci√≥n JWT  
‚úÖ **Seguridad multicapa** frontend y backend  
‚úÖ **Control de acceso granular** por funcionalidades

### Evoluci√≥n futura

El sistema est√° preparado para evolucionar con nuevas caracter√≠sticas:

üîπ M√≥dulo de inventario y productos  
üîπ Sistema de recordatorios y notificaciones  
üîπ Integraci√≥n con pasarelas de pago  
üîπ Aplicaci√≥n m√≥vil complementaria  
üîπ Panel de estad√≠sticas avanzadas  

---

## üèõÔ∏è Gu√≠a Completa de M√≥dulos del Sistema

Esta secci√≥n proporciona una **explicaci√≥n detallada m√≥dulo por m√≥dulo** del funcionamiento del sistema, desde la perspectiva tanto del **usuario** como del **administrador**, incluyendo c√≥digo cr√≠tico del frontend y backend.

### üîê M√≥dulo de Autenticaci√≥n (Login)

El proceso de autenticaci√≥n es el **punto de entrada** al sistema para todos los usuarios.

#### Frontend - Componente Login

```javascript
// Login.js - Componente de autenticaci√≥n
function Login() {
  const [correo, setCorreo] = useState('');
  const [contrasenia, setContrasenia] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const [apiStatus, setApiStatus] = useState('checking');

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    // ‚≠ê Validaci√≥n b√°sica en frontend
    if (!correo.trim() || !contrasenia.trim()) {
      setError('Por favor, complete todos los campos');
      return;
    }
    
    setLoading(true);
    setError('');
    
    try {
      console.log('Intentando iniciar sesi√≥n con:', { correo });
      
      // üîë Llamada al servicio de autenticaci√≥n
      const respuesta = await authService.login(correo, contrasenia);
      
      console.log('Login exitoso:', respuesta);
      
      // üö¶ Verificaci√≥n de rol para redirecci√≥n
      if (respuesta.usuario.rol === 'admin') {
        // Redirigir al panel de administrador
        window.location.href = '/admin';
      } else {
        // Redirigir al dashboard de usuario
        window.location.href = '/dashboard';
      }
      
    } catch (error) {
      console.error('Error en login:', error);
      setError(error.message || 'Error al iniciar sesi√≥n');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="login-container">
      <form onSubmit={handleSubmit} className="login-form">
        <h2>üêæ Veterinaria Mordisco</h2>
        
        {/* ‚ö†Ô∏è Mostrar errores de autenticaci√≥n */}
        {error && <div className="error-message">{error}</div>}
        
        <input
          type="email"
          placeholder="Correo electr√≥nico"
          value={correo}
          onChange={(e) => setCorreo(e.target.value)}
          required
        />
        
        <input
          type="password"
          placeholder="Contrase√±a"
          value={contrasenia}
          onChange={(e) => setContrasenia(e.target.value)}
          required
        />
        
        <button type="submit" disabled={loading}>
          {loading ? 'Iniciando sesi√≥n...' : 'Iniciar Sesi√≥n'}
        </button>
      </form>
    </div>
  );
}
```

#### Backend - Controlador de Autenticaci√≥n

```javascript
// auth.controller.js - L√≥gica de autenticaci√≥n en el servidor
const login = async (req, res) => {
  try {
    const { correo, contrasenia } = req.body;

    // üîç Validaci√≥n de campos requeridos
    if (!correo || !contrasenia) {
      return res.status(400).json({
        success: false,
        message: 'El correo y contrase√±a son requeridos'
      });
    }

    // üîç Buscar usuario en la base de datos
    const usuario = await Usuario.findOne({ 
      where: { 
        correo,
        estado: 'A'  // Solo usuarios activos
      } 
    });

    if (!usuario) {
      return res.status(401).json({
        success: false,
        message: 'Credenciales inv√°lidas'
      });
    }

    // üîí Verificar contrase√±a hasheada
    const passwordValido = await bcrypt.compare(contrasenia, usuario.contrasenia);

    if (!passwordValido) {
      return res.status(401).json({
        success: false,
        message: 'Credenciales inv√°lidas'
      });
    }

    // üéüÔ∏è Crear payload del token JWT
    const payload = {
      usuario: {
        id: usuario.id_usuario,
        nombre: usuario.nombre,
        correo: usuario.correo,
        rol: usuario.rol  // ‚≠ê ROL CR√çTICO PARA AUTORIZACI√ìN
      }
    };

    // üîê Generar token JWT firmado
    jwt.sign(
      payload,
      jwtConfig.jwtSecret,
      { expiresIn: jwtConfig.jwtExpiration },
      (err, token) => {
        if (err) throw err;
        
        // ‚úÖ Respuesta exitosa con token y datos del usuario
        res.json({
          success: true,
          message: 'Login exitoso',
          token,
          usuario: {
            id: usuario.id_usuario,
            nombre: usuario.nombre,
            correo: usuario.correo,
            rol: usuario.rol  // ‚≠ê ROL DISPONIBLE PARA EL FRONTEND
          }
        });
      }
    );
  } catch (error) {
    console.error('Error en login:', error);
    res.status(500).json({
      success: false,
      message: 'Error en el servidor'
    });
  }
};
```

#### Puntos Clave del Login:
- **üîë Autenticaci√≥n dual**: Verificaci√≥n en frontend y backend
- **üîí Seguridad**: Contrase√±as hasheadas con bcrypt
- **üéüÔ∏è JWT**: Tokens firmados con informaci√≥n del usuario y rol
- **üö¶ Redirecci√≥n inteligente**: Seg√∫n el rol del usuario
- **‚ö†Ô∏è Manejo de errores**: Mensajes claros para el usuario

---

### üëë Vista Administrador

Los administradores tienen **acceso completo** a todas las funcionalidades del sistema.

#### üìä Dashboard Administrativo

```javascript
// AdminPanel.js - Panel principal de administraci√≥n
const AdminPanel = () => {
  return (
    <div className="admin-panel">
      <h1>üëë Panel de Administraci√≥n</h1>
      <p>Esta secci√≥n es solo para administradores de la Veterinaria Mordisco</p>
      
      {/* üéØ Tarjetas de acceso r√°pido */}
      <div className="admin-cards">
        <div className="admin-card">
          <h3>üë• Gesti√≥n de Usuarios</h3>
          <p>Administrar cuentas del sistema</p>
          <Link to="/admin/usuarios">Acceder</Link>
        </div>
        
        <div className="admin-card">
          <h3>üë§ Gesti√≥n de Clientes</h3>
          <p>Administrar informaci√≥n de clientes</p>
          <Link to="/admin/clientes">Acceder</Link>
        </div>
        
        <div className="admin-card">
          <h3>üêæ Gesti√≥n de Pacientes</h3>
          <p>Administrar mascotas registradas</p>
          <Link to="/admin/pacientes">Acceder</Link>
        </div>
        
        <div className="admin-card">
          <h3>üìÖ Gesti√≥n de Citas</h3>
          <p>Administrar agenda de citas</p>
          <Link to="/admin/citas">Acceder</Link>
        </div>
      </div>
      
      <div className="admin-notification">
        <h3>üîê Acceso administrativo</h3>
        <p>Has iniciado sesi√≥n como administrador y tienes acceso a funcionalidades privilegiadas.</p>
      </div>
    </div>
  );
};
```

#### üë• Gesti√≥n de Usuarios (Solo Administradores)

**Frontend - Componente cr√≠tico:**

```javascript
// GestionUsuarios.js - CRUD completo de usuarios
function GestionUsuarios() {
  const [usuarios, setUsuarios] = useState([]);
  const [showModal, setShowModal] = useState(false);
  const [modalMode, setModalMode] = useState('create');
  const [formData, setFormData] = useState({
    nombre: '',
    correo: '',
    contrasenia: '',
    rol: 'usuario'  // ‚≠ê ROL POR DEFECTO
  });

  // üîê VERIFICACI√ìN CR√çTICA DE PERMISOS
  const isAdmin = authService.hasRole('administrador');

  // üì• Cargar usuarios desde la API
  const fetchUsuarios = async () => {
    try {
      setLoading(true);
      const data = await usuarioService.getAll();
      setUsuarios(data);
      setError(null);
    } catch (err) {
      console.error("Error al cargar usuarios:", err);
      setError("Error al cargar los usuarios. Por favor, intente nuevamente.");
    } finally {
      setLoading(false);
    }
  };

  // ‚ûï Crear nuevo usuario
  const handleSaveUser = async () => {
    if (!validateForm()) return;
    
    try {
      if (modalMode === 'create') {
        // üîê Hash de contrase√±a en el backend
        await usuarioService.create(formData);
        showAlert('success', 'Usuario creado exitosamente');
      } else {
        await usuarioService.update(selectedUser.id_usuario, formData);
        showAlert('success', 'Usuario actualizado exitosamente');
      }
      
      fetchUsuarios(); // Recargar lista
      handleCloseModal();
    } catch (err) {
      console.error('Error al guardar usuario:', err);
      showAlert('error', 'Error al guardar el usuario');
    }
  };

  return (
    <div className="page-content">
      {/* üö´ CONTROL DE ACCESO CR√çTICO */}
      {!isAdmin ? (
        <div className="alert alert-danger">
          <div className="alert-icon">üö´</div>
          <div className="alert-content">
            <p className="alert-message">
              <strong>Acceso Denegado:</strong> No tiene permisos para acceder a la gesti√≥n de usuarios. 
              Esta funci√≥n est√° disponible √∫nicamente para administradores.
            </p>
          </div>
        </div>
      ) : (
        <div className="usuarios-container fade-in">
          <div className="usuarios-header">
            <h2>üë• Gesti√≥n de Usuarios</h2>
            <button 
              className="btn btn-primary"
              onClick={() => handleShowModal('create')}
            >
              ‚ûï Nuevo Usuario
            </button>
          </div>
          
          {/* üîç Barra de b√∫squeda */}
          <div className="search-container">
            <input
              type="text"
              placeholder="Buscar usuarios..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="search-input"
            />
          </div>
          
          {/* üìä Tabla de usuarios con funciones CRUD */}
          <DataTableUsuarios 
            usuarios={paginatedData}
            onEdit={handleShowModal}
            onDelete={handleShowDeleteModal}
            sortConfig={sortConfig}
            onSort={requestSort}
          />
        </div>
      )}
    </div>
  );
}
```

**Backend - Controlador de usuarios:**

```javascript
// usuario.controller.js - L√≥gica del servidor para usuarios
const create = async (req, res) => {
  try {
    console.log('Datos recibidos en la petici√≥n:', req.body);
    
    // üîç Verificar campos requeridos
    if (!req.body.nombre || !req.body.correo || !req.body.contrasenia) {
      return res.status(400).json({ 
        success: false, 
        mensaje: 'Los campos nombre, correo y contrase√±a son obligatorios',
        datosRecibidos: req.body
      });
    }
    
    // ‚≠ê PUNTO CR√çTICO: Hash de contrase√±a antes de guardar
    const usuarioData = {
      ...req.body,
      contrasenia: await bcrypt.hash(req.body.contrasenia, 10),
      creado_en: new Date(),
      actualizado_en: new Date(),
      estado: 'A'
    };
    
    const nuevo = await service.create(usuarioData);
    console.log('Usuario creado:', nuevo);
    res.status(201).json(nuevo);
  } catch (error) {
    console.error('Error al crear usuario:', error);
    res.status(500).json({ 
      success: false, 
      mensaje: 'Error al crear usuario', 
      error: error.message 
    });
  }
};

const getAll = async (req, res) => {
  try {
    // üîê SOLO USUARIOS AUTENTICADOS pueden ver la lista
    const data = await service.getAll();
    res.json(data);
  } catch (error) {
    res.status(500).json({ 
      success: false, 
      mensaje: 'Error al obtener usuarios' 
    });
  }
};
```

#### üë§ Gesti√≥n de Clientes

**Frontend - Funcionalidad completa:**

```javascript
// GestionClientes.js - CRUD de clientes para administradores
function GestionClientes() {
  const [clientes, setClientes] = useState([]);
  const [formData, setFormData] = useState({
    nombre_completo: '',
    cedula: '',
    correo: '',
    telefono: '',
    direccion: ''
  });

  // üì• Cargar clientes desde la API
  const fetchClientes = async () => {
    try {
      setLoading(true);
      const data = await clienteService.getAll();
      setClientes(data);
      setError(null);
    } catch (err) {
      console.error("Error al cargar clientes:", err);
      setError("Error al cargar los clientes. Por favor, intente nuevamente.");
    } finally {
      setLoading(false);
    }
  };

  // ‚úÖ Validaci√≥n de datos del cliente
  const validateForm = () => {
    const errors = {};
    
    if (!formData.nombre_completo.trim()) {
      errors.nombre_completo = 'El nombre es obligatorio';
    }
    
    if (!formData.cedula.trim()) {
      errors.cedula = 'La c√©dula es obligatoria';
    } else if (!/^\d+$/.test(formData.cedula)) {
      errors.cedula = 'La c√©dula debe contener solo n√∫meros';
    }
    
    if (!formData.correo.trim()) {
      errors.correo = 'El correo es obligatorio';
    } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.correo)) {
      errors.correo = 'Formato de correo inv√°lido';
    }
    
    if (!formData.telefono.trim()) {
      errors.telefono = 'El tel√©fono es obligatorio';
    }
    
    setFormErrors(errors);
    return Object.keys(errors).length === 0;
  };

  // üíæ Guardar cliente (crear o actualizar)
  const handleSaveCliente = async () => {
    if (!validateForm()) return;
    
    try {
      if (modalMode === 'create') {
        await clienteService.create(formData);
        showAlert('success', 'Cliente creado exitosamente');
      } else {
        await clienteService.update(selectedCliente.id_cliente, formData);
        showAlert('success', 'Cliente actualizado exitosamente');
      }
      
      fetchClientes(); // ‚ôªÔ∏è Recargar lista
      handleCloseModal();
    } catch (err) {
      console.error('Error al guardar cliente:', err);
      showAlert('error', 'Error al guardar el cliente');
    }
  };

  return (
    <div className="clientes-container">
      <div className="clientes-header">
        <h2>üë§ Gesti√≥n de Clientes</h2>
        <button onClick={() => handleShowModal('create')}>
          ‚ûï Nuevo Cliente
        </button>
      </div>
      
      {/* üìä Tabla de clientes */}
      <DataTable 
        datos={clientes}
        columnas={columnasClientes}
        acciones={(cliente) => (
          <>
            <button onClick={() => handleEditCliente(cliente)}>‚úèÔ∏è Editar</button>
            <button onClick={() => handleDeleteCliente(cliente)}>üóëÔ∏è Eliminar</button>
          </>
        )}
      />
    </div>
  );
}
```

**Backend - Servicio de clientes:**

```javascript
// cliente.service.js - L√≥gica de negocio para clientes
const { Cliente } = require('../models');

const getAll = async () => {
  try {
    // üìä Obtener todos los clientes con informaci√≥n ordenada
    return await Cliente.findAll({
      order: [['creado_en', 'DESC']],
      attributes: { exclude: ['contrasenia'] } // üîê Excluir campos sensibles
    });
  } catch (error) {
    console.error('Error en getAll clientes:', error);
    throw error;
  }
};

const create = async (data) => {
  try {
    // ‚úÖ Validaciones cr√≠ticas del servidor
    if (!data.nombre_completo || !data.cedula || !data.correo) {
      throw new Error('Campos obligatorios faltantes');
    }
    
    // üîç Verificar que la c√©dula no est√© duplicada
    const existeCliente = await Cliente.findOne({
      where: { cedula: data.cedula }
    });
    
    if (existeCliente) {
      throw new Error('Ya existe un cliente con esta c√©dula');
    }
    
    // ‚ûï Agregar fechas autom√°ticas
    const clienteData = {
      ...data,
      creado_en: new Date(),
      actualizado_en: new Date(),
      estado: 'A'
    };
    
    return await Cliente.create(clienteData);
  } catch (error) {
    console.error('Error en create cliente:', error);
    throw error;
  }
};
```

#### üêæ Gesti√≥n de Pacientes

**Frontend - Control de mascotas:**

```javascript
// GestionPacientes.js - CRUD de pacientes
function GestionPacientes() {
  const [pacientes, setPacientes] = useState([]);
  const [clientes, setClientes] = useState([]); // Para el dropdown
  const [formData, setFormData] = useState({
    nombre: '',
    especie: '',
    raza: '',
    edad: '',
    sexo: '',
    color: '',
    peso: '',
    fecha_nacimiento: '',
    observaciones: '',
    cliente_id: ''  // ‚≠ê RELACI√ìN CR√çTICA CON CLIENTE
  });

  // üì• Cargar pacientes y clientes
  useEffect(() => {
    const loadData = async () => {
      try {
        const [pacientesData, clientesData] = await Promise.all([
          pacienteService.getAll(),
          clienteService.getAll()
        ]);
        setPacientes(pacientesData);
        setClientes(clientesData);
      } catch (error) {
        console.error('Error cargando datos:', error);
      }
    };
    
    loadData();
  }, []);

  // üíæ Guardar paciente con validaciones
  const handleSavePaciente = async () => {
    if (!validatePacienteForm()) return;
    
    try {
      // üîó Datos con relaci√≥n al cliente
      const pacienteData = {
        ...formData,
        cliente_id: parseInt(formData.cliente_id), // ‚≠ê CONVERSI√ìN CR√çTICA
        peso: parseFloat(formData.peso) || null,
        edad: parseInt(formData.edad) || null
      };
      
      if (modalMode === 'create') {
        await pacienteService.create(pacienteData);
        showAlert('success', 'üêæ Paciente registrado exitosamente');
      } else {
        await pacienteService.update(selectedPaciente.id_paciente, pacienteData);
        showAlert('success', 'üêæ Paciente actualizado exitosamente');
      }
      
      fetchPacientes();
      handleCloseModal();
    } catch (err) {
      console.error('Error al guardar paciente:', err);
      showAlert('error', 'Error al guardar el paciente');
    }
  };

  return (
    <div className="pacientes-container">
      <div className="pacientes-header">
        <h2>üêæ Gesti√≥n de Pacientes</h2>
        <button onClick={() => handleShowModal('create')}>
          ‚ûï Nuevo Paciente
        </button>
      </div>
      
      {/* üîç Filtros por especie */}
      <div className="filtros-container">
        <select onChange={(e) => filtrarPorEspecie(e.target.value)}>
          <option value="">Todas las especies</option>
          <option value="Perro">üê∂ Perros</option>
          <option value="Gato">üê± Gatos</option>
          <option value="Ave">üê¶ Aves</option>
          <option value="Otros">üêæ Otros</option>
        </select>
      </div>
      
      {/* üìä Tabla de pacientes con informaci√≥n del cliente */}
      <DataTable 
        datos={pacientes}
        columnas={columnasPacientes}
        acciones={(paciente) => (
          <>
            <button onClick={() => verHistorial(paciente)}>üìã Historial</button>
            <button onClick={() => handleEditPaciente(paciente)}>‚úèÔ∏è Editar</button>
            <button onClick={() => handleDeletePaciente(paciente)}>üóëÔ∏è Eliminar</button>
          </>
        )}
      />
    </div>
  );
}
```

**Backend - Controlador con relaciones:**

```javascript
// paciente.controller.js - Manejo de pacientes con relaciones
const { Paciente, Cliente } = require('../models');

const getAll = async (req, res) => {
  try {
    // üîó RELACI√ìN CR√çTICA: Incluir datos del cliente
    const pacientes = await Paciente.findAll({
      include: [{
        model: Cliente,
        as: 'cliente',
        attributes: ['id_cliente', 'nombre_completo', 'telefono', 'correo']
      }],
      order: [['creado_en', 'DESC']]
    });
    
    res.json(pacientes);
  } catch (error) {
    console.error('Error al obtener pacientes:', error);
    res.status(500).json({ 
      success: false, 
      mensaje: 'Error al obtener pacientes' 
    });
  }
};

const create = async (req, res) => {
  try {
    // ‚úÖ Validaciones cr√≠ticas
    if (!req.body.nombre || !req.body.especie || !req.body.cliente_id) {
      return res.status(400).json({
        success: false,
        mensaje: 'Nombre, especie y cliente son obligatorios'
      });
    }
    
    // üîç Verificar que el cliente existe
    const clienteExiste = await Cliente.findByPk(req.body.cliente_id);
    if (!clienteExiste) {
      return res.status(400).json({
        success: false,
        mensaje: 'El cliente especificado no existe'
      });
    }
    
    const nuevoPaciente = await Paciente.create({
      ...req.body,
      creado_en: new Date(),
      actualizado_en: new Date(),
      estado: 'A'
    });
    
    res.status(201).json(nuevoPaciente);
  } catch (error) {
    console.error('Error al crear paciente:', error);
    res.status(500).json({ 
      success: false, 
      mensaje: 'Error al crear paciente' 
    });
  }
};
```

#### üìÖ Gesti√≥n de Citas

**Frontend - Sistema de agenda:**

```javascript
// GestionCitas.js - CRUD de citas con calendario
function GestionCitas() {
  const [citas, setCitas] = useState([]);
  const [pacientes, setPacientes] = useState([]);
  const [formData, setFormData] = useState({
    fecha_cita: '',
    hora_cita: '',
    motivo: '',
    estado: 'Programada',
    observaciones: '',
    paciente_id: '',  // ‚≠ê RELACI√ìN CR√çTICA CON PACIENTE
    veterinario: ''
  });

  // üìÖ Validar fecha y hora de la cita
  const validateCitaForm = () => {
    const errors = {};
    
    // üìÖ Validar que la fecha no sea en el pasado
    const fechaCita = new Date(formData.fecha_cita + 'T' + formData.hora_cita);
    const ahora = new Date();
    
    if (fechaCita <= ahora) {
      errors.fecha_cita = 'La fecha y hora debe ser en el futuro';
    }
    
    // üïí Validar horario de atenci√≥n (8:00 AM - 6:00 PM)
    const hora = parseInt(formData.hora_cita.split(':')[0]);
    if (hora < 8 || hora >= 18) {
      errors.hora_cita = 'Horario de atenci√≥n: 8:00 AM - 6:00 PM';
    }
    
    if (!formData.paciente_id) {
      errors.paciente_id = 'Debe seleccionar un paciente';
    }
    
    if (!formData.motivo.trim()) {
      errors.motivo = 'El motivo de la cita es obligatorio';
    }
    
    setFormErrors(errors);
    return Object.keys(errors).length === 0;
  };

  // üíæ Guardar cita con validaciones
  const handleSaveCita = async () => {
    if (!validateCitaForm()) return;
    
    try {
      const citaData = {
        ...formData,
        paciente_id: parseInt(formData.paciente_id),
        fecha_hora: new Date(formData.fecha_cita + 'T' + formData.hora_cita)
      };
      
      if (modalMode === 'create') {
        await citaService.create(citaData);
        showAlert('success', 'üìÖ Cita programada exitosamente');
      } else {
        await citaService.update(selectedCita.id_cita, citaData);
        showAlert('success', 'üìÖ Cita actualizada exitosamente');
      }
      
      fetchCitas();
      handleCloseModal();
    } catch (err) {
      console.error('Error al guardar cita:', err);
      showAlert('error', 'Error al programar la cita');
    }
  };

  return (
    <div className="citas-container">
      <div className="citas-header">
        <h2>üìÖ Gesti√≥n de Citas</h2>
        <button onClick={() => handleShowModal('create')}>
          ‚ûï Nueva Cita
        </button>
      </div>
      
      {/* üìä Vista de calendario */}
      <div className="calendario-container">
        <CalendarioCitas citas={citas} onCitaClick={handleEditCita} />
      </div>
      
      {/* üìã Lista de citas por estado */}
      <div className="filtros-estado">
        <button onClick={() => filtrarPorEstado('Programada')}>
          üü° Programadas
        </button>
        <button onClick={() => filtrarPorEstado('Completada')}>
          üü¢ Completadas
        </button>
        <button onClick={() => filtrarPorEstado('Cancelada')}>
          üî¥ Canceladas
        </button>
      </div>
    </div>
  );
}
```

---

### üë§ Vista Usuario (Veterinario)

Los usuarios con rol **veterinario** tienen acceso limitado a funcionalidades operativas.

#### üìä Dashboard de Usuario

```javascript
// Dashboard.js - Panel principal para veterinarios
const Dashboard = () => {
  const [clientesCount, setClientesCount] = useState(0);
  const [pacientesCount, setPacientesCount] = useState(0);
  const [especiesDistribution, setEspeciesDistribution] = useState({
    perros: 0,
    gatos: 0,
    otros: 0
  });
  const [latestPaciente, setLatestPaciente] = useState(null);

  // üìä Cargar estad√≠sticas del dashboard
  useEffect(() => {
    const loadDashboardData = async () => {
      try {
        // üìà Obtener conteos y estad√≠sticas
        const [clientesData, pacientesData] = await Promise.all([
          clienteService.getAll(),
          pacienteService.getAll()
        ]);
        
        setClientesCount(clientesData.length);
        setPacientesCount(pacientesData.length);
        
        // üìä Calcular distribuci√≥n por especies
        const distribucion = pacientesData.reduce((acc, paciente) => {
          const especie = paciente.especie?.toLowerCase();
          if (especie === 'perro') acc.perros++;
          else if (especie === 'gato') acc.gatos++;
          else acc.otros++;
          return acc;
        }, { perros: 0, gatos: 0, otros: 0 });
        
        setEspeciesDistribution(distribucion);
        
        // üÜï √öltimo paciente registrado
        if (pacientesData.length > 0) {
          setLatestPaciente(pacientesData[0]);
        }
      } catch (error) {
        console.error('Error cargando datos del dashboard:', error);
      }
    };
    
    loadDashboardData();
  }, []);

  return (
    <div className="dashboard-container">
      <h1>üè• Dashboard - Veterinaria Mordisco</h1>
      
      {/* üìä Tarjetas de estad√≠sticas */}
      <div className="stats-grid">
        <div className="stat-card">
          <div className="stat-icon">üë•</div>
          <div className="stat-info">
            <h3>{clientesCount}</h3>
            <p>Clientes Registrados</p>
          </div>
        </div>
        
        <div className="stat-card">
          <div className="stat-icon">üêæ</div>
          <div className="stat-info">
            <h3>{pacientesCount}</h3>
            <p>Pacientes Registrados</p>
          </div>
        </div>
        
        <div className="stat-card">
          <div className="stat-icon">üê∂</div>
          <div className="stat-info">
            <h3>{especiesDistribution.perros}</h3>
            <p>Perros</p>
          </div>
        </div>
        
        <div className="stat-card">
          <div className="stat-icon">üê±</div>
          <div className="stat-info">
            <h3>{especiesDistribution.gatos}</h3>
            <p>Gatos</p>
          </div>
        </div>
      </div>
      
      {/* üÜï √öltimo paciente registrado */}
      {latestPaciente && (
        <div className="latest-patient">
          <h3>üÜï √öltimo Paciente Registrado</h3>
          <div className="patient-card">
            <span className="patient-icon">
              {getSpeciesIcon(latestPaciente.especie)}
            </span>
            <div className="patient-info">
              <h4>{latestPaciente.nombre}</h4>
              <p>{latestPaciente.especie} - {latestPaciente.raza}</p>
              <p>Cliente: {latestPaciente.cliente?.nombre_completo}</p>
            </div>
          </div>
        </div>
      )}
      
      {/* üéØ Accesos r√°pidos para veterinarios */}
      <div className="quick-actions">
        <h3>üéØ Accesos R√°pidos</h3>
        <div className="action-buttons">
          <Link to="/pacientes" className="action-btn">
            üêæ Ver Pacientes
          </Link>
          <Link to="/citas" className="action-btn">
            üìÖ Ver Citas del D√≠a
          </Link>
          <Link to="/clientes" className="action-btn">
            üë• Buscar Clientes
          </Link>
        </div>
      </div>
    </div>
  );
};
```

#### Limitaciones del Usuario Veterinario:

**‚ùå No puede acceder a:**
- Gesti√≥n de usuarios del sistema
- Configuraciones administrativas
- Reportes financieros
- Eliminaci√≥n de registros cr√≠ticos

**‚úÖ Puede acceder a:**
- Dashboard con estad√≠sticas
- Consulta de clientes y pacientes
- Gesti√≥n de citas
- Historial m√©dico de pacientes

### üîë Puntos Cr√≠ticos del Sistema

#### 1. **Seguridad Multicapa**
```javascript
// Verificaci√≥n en cada nivel
Frontend: authService.hasRole('admin') 
Backend: verifyToken + verifyRole(['admin'])
Database: Estado activo + validaciones
```

#### 2. **Relaciones de Base de Datos**
```sql
-- Relaciones cr√≠ticas
Paciente -> Cliente (FOREIGN KEY)
Cita -> Paciente (FOREIGN KEY)
Usuario -> Roles (ENUM: 'admin', 'usuario')
```

#### 3. **Validaciones Cr√≠ticas**
- **Frontend**: Validaci√≥n inmediata de UX
- **Backend**: Validaci√≥n de seguridad obligatoria
- **Database**: Constraints y triggers

#### 4. **Manejo de Estados**
```javascript
// Estados cr√≠ticos del sistema
Estado Usuario: 'A' (Activo), 'I' (Inactivo)
Estado Cita: 'Programada', 'Completada', 'Cancelada'
Estado Paciente: 'A' (Activo), 'I' (Inactivo)
```

Esta arquitectura garantiza que cada **m√≥dulo funcione de manera independiente** pero **integrada**, con controles de seguridad robustos y una experiencia de usuario fluida tanto para administradores como para veterinarios.

